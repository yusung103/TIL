# JPA 영속성 컨텍스트
`엔티티를 영구 저장`하는 환경이란 뜻  
> 애플리케이션과 DB사이에서 객체를 보관하는(캐시) 가상의 DB역할

* **엔티티 메니저**를 통해 엔티티를 저장, 조회하면 엔티티 메니저는 영속성 컨텍스트에 엔티티를 보관하고 관리한다 (엔티티의 생명주기 관리)
* 엔티티 메니저를 생성할 때 만들어짐
* 엔티티 메니저를 통해 DB에 접근 가능

### 엔티티 메니저?
* 엔티티에 대한 CRUD 등의 작업을 수행  
* 엔티티 매니저를 통해 데이터베이스와의 상호작용이 이루어지며, 이를 통해 얻은 엔티티는 영속성 컨텍스트 내에서 관리

***

### 엔티티의 생명주기
* 비영속 (new/transient): 영속성 컨텍스트와 관계가 없는 상태
* 영속 (managed): 영속성 컨텍스트에 저장된 상태
* 준영속 (detached): 영속성 컨텍스트에 저장되었다가 분리된 상태
* 삭제 (removed): 영속성 컨텍스트에 삭제된 상태

#### 비영속
엔티티 객체를 생성했지만 영속성 컨텍스트에 저장되지 않은 상태  
```java 
Member member = new Member();
```

#### 영속
엔티티 객체가 영속성 컨텍스트에 엔티티 메니저를 통해 저장된 상태. 영속성 컨텍스트에 의해 관리됨  
```java
em.persist(member);
```

#### 준영속
영속성 엔티티를 관리하지 않으면 준영속 엔티티 상태가 됨. 특정 엔티티를 준영속 엔티티로 만들려면 `em.detach();`를 호출하면 됨
```java
// 영속성 컨텍스트에서 분리해 준영속 상태로 만듬
em.detach(member);

// 영속성 컨텍스트를 비워도 관리되던 엔티티는 준영속 상태가 됨
em.clear();

//영속성 컨텍스트를 종료해도 관리되던 엔티티는 준영속 상태가 됨
em.close();
```

#### 삭제
엔티티를 영속성 컨텍스트와 DB에 삭제시킴  
```java
em.remove(member);
```